# QuantCapital æ··åˆé‡åŒ–äº¤æ˜“ç³»ç»Ÿ - ç”¨æˆ·æ‰‹å†Œ

## ğŸ“‹ æ¦‚è¿°

QuantCapital æ˜¯ä¸“ä¸ºAè‚¡å¸‚åœºè®¾è®¡çš„é«˜æ€§èƒ½é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œé‡‡ç”¨Python+Javaæ··åˆæ¶æ„ï¼š

- **Pythonç«¯**ï¼šè´Ÿè´£æ•°æ®è·å–ä¸å­˜å‚¨ï¼ˆAKShareã€æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ã€Parquetæ–‡ä»¶ã€DuckDBã€SQLiteï¼‰
- **Javaç«¯**ï¼šè´Ÿè´£äº‹ä»¶é©±åŠ¨å¼•æ“åŠæ•´ä¸ªå›æµ‹/å®ç›˜äº¤æ˜“æµç¨‹ï¼ˆé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿï¼‰

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âš¡ **é«˜æ€§èƒ½**ï¼šJavaç«¯åŸºäºJDK 21è™šæ‹Ÿçº¿ç¨‹ï¼ŒZGCåƒåœ¾æ”¶é›†å™¨ï¼Œæ”¯æŒä¸‡çº§TPSäº‹ä»¶å¤„ç†
- ğŸ”„ **äº‹ä»¶é©±åŠ¨**ï¼šå¼‚æ­¥äº‹ä»¶å¤„ç†æ¶æ„ï¼Œæ•…éšœéš”ç¦»ï¼Œä½å»¶è¿Ÿå“åº”
- ğŸ“Š **æ•°æ®å…¼å®¹**ï¼šå®Œç¾è¯»å–Pythonç”Ÿæˆçš„Parquetã€DuckDBã€SQLiteæ•°æ®
- ğŸ§  **æ™ºèƒ½ç­–ç•¥**ï¼šæ”¯æŒå¼€å•ç­–ç•¥ã€æ­¢ç›ˆæ­¢æŸç­–ç•¥ã€é€šç”¨å¼ºåˆ¶æ­¢æŸç­–ç•¥
- ğŸ›¡ï¸ **é£æ§å®Œå–„**ï¼šå¤šå±‚æ¬¡é£æ§æ£€æŸ¥ï¼Œå®æ—¶ä»“ä½ç®¡ç†ï¼Œé£é™©ç›‘æ§
- ğŸ”§ **é…ç½®çµæ´»**ï¼šæ”¯æŒå›æµ‹/å®ç›˜ç¯å¢ƒåˆ‡æ¢ï¼Œå‚æ•°çƒ­æ›´æ–°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

#### ç³»ç»Ÿè¦æ±‚
- **Java 21+**ï¼ˆå¿…é¡»æ”¯æŒè™šæ‹Ÿçº¿ç¨‹ï¼‰
- **Python 3.11+**
- **Maven 3.11+**
- **å†…å­˜**ï¼šå»ºè®®8GBä»¥ä¸Š
- **å­˜å‚¨**ï¼š10GBä»¥ä¸Šï¼ˆç”¨äºæ•°æ®å­˜å‚¨ï¼‰

#### Pythonä¾èµ–å®‰è£…

```bash
# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# éªŒè¯Pythonç¯å¢ƒ
python -c "import akshare, pandas, numpy; print('Pythonç¯å¢ƒå°±ç»ª')"
```

#### Javaç¯å¢ƒé…ç½®

```bash
# éªŒè¯Javaç‰ˆæœ¬
java -version  # éœ€è¦æ˜¾ç¤º21æˆ–æ›´é«˜ç‰ˆæœ¬

# éªŒè¯Maven
mvn -version
```

### 2. é¡¹ç›®ç»“æ„

```
quant-trading/
â”œâ”€â”€ python/                    # Pythonæ•°æ®å¤„ç†æ¨¡å—
â”‚   â””â”€â”€ quantcapital/         # æ ¸å¿ƒPythonåº“
â”œâ”€â”€ src/                      # Javaäº¤æ˜“å¼•æ“
â”‚   â”œâ”€â”€ main/java/           # Javaä¸»ä»£ç 
â”‚   â””â”€â”€ test/java/           # Javaæµ‹è¯•ä»£ç 
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ python/              # Pythonä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ java/                # Javaä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ docs/                    # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”œâ”€â”€ pom.xml                 # Java Mavené…ç½®
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

### 3. å¿«é€Ÿå¯åŠ¨

#### æ­¥éª¤1ï¼šæ•°æ®å‡†å¤‡ï¼ˆPythonç«¯ï¼‰

```bash
# è¿›å…¥Pythonæ¨¡å—ç›®å½•
cd python

# è·å–å†å²æ•°æ®ï¼ˆç¤ºä¾‹ï¼‰
python examples/python/quick_start.py

# éªŒè¯æ•°æ®æ–‡ä»¶ç”Ÿæˆ
ls -la .data/  # åº”è¯¥çœ‹åˆ°parquetæ–‡ä»¶å’Œæ•°æ®åº“æ–‡ä»¶
```

#### æ­¥éª¤2ï¼šå¯åŠ¨äº¤æ˜“å¼•æ“ï¼ˆJavaç«¯ï¼‰

```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# ç¼–è¯‘Javaé¡¹ç›®
mvn clean compile

# è¿è¡Œæµ‹è¯•ï¼ˆéªŒè¯ç¯å¢ƒï¼‰
mvn test

# å¯åŠ¨å›æµ‹æ¨¡å¼
mvn spring-boot:run -Dspring.profiles.active=backtest

# å¯åŠ¨å®ç›˜æ¨¡å¼
mvn spring-boot:run -Dspring.profiles.active=live
```

## âš™ï¸ é…ç½®è¯´æ˜

### Javaç«¯é…ç½®

ä¸»è¦é…ç½®æ–‡ä»¶ï¼š`src/main/resources/application.yml`

```yaml
# å›æµ‹ç¯å¢ƒé…ç½®
spring:
  profiles:
    active: backtest

quantcapital:
  data:
    root-path: "python/.data"           # Pythonæ•°æ®æ–‡ä»¶è·¯å¾„
    parquet-path: "${quantcapital.data.root-path}/parquet"
    duckdb-path: "${quantcapital.data.root-path}/market.duckdb"
    sqlite-path: "${quantcapital.data.root-path}/business.db"
  
  backtest:
    start-date: "2023-01-01"
    end-date: "2024-01-01"
    initial-capital: 1000000.0
    benchmark: "000300.SH"  # æ²ªæ·±300
  
  execution:
    slippage: 0.001              # æ»‘ç‚¹ 0.1%
    commission-rate: 0.0003      # æ‰‹ç»­è´¹ 0.03%
    delay-ms: 100                # æ‰§è¡Œå»¶è¿Ÿ
  
  risk:
    max-position-pct: 0.05       # å•ä¸ªæ ‡çš„æœ€å¤§ä»“ä½5%
    max-total-position-pct: 0.95 # æ€»ä»“ä½ä¸Šé™95%
    stop-loss-pct: 0.1           # æ­¢æŸé˜ˆå€¼10%
```

### Pythonç«¯é…ç½®

é…ç½®æ–‡ä»¶ï¼š`python/config/backtest.json`

```json
{
  "env": "backtest",
  "data_root": "./.data",
  "business_db_path": "./.data/business.db",
  "initial_capital": 1000000.0,
  "data_source": {
    "request_delay": 0.1
  },
  "execution": {
    "slippage": 0.001,
    "commission_rate": 0.0003,
    "delay_seconds": 1
  },
  "portfolio": {
    "max_position_pct": 0.05,
    "max_total_position_pct": 0.95,
    "min_order_amount": 1000
  }
}
```

## ğŸ“Š æ•°æ®æµç¨‹

### 1. Pythonæ•°æ®è·å–

```python
# ä½¿ç”¨AKShareè·å–è‚¡ç¥¨æ•°æ®
import akshare as ak
from quantcapital.data.data_manager import DataManager

# åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
dm = DataManager()

# è·å–è‚¡ç¥¨åˆ—è¡¨
stock_list = ak.stock_zh_a_spot_em()

# è·å–å†å²æ•°æ®
for symbol in stock_list['ä»£ç '][:100]:  # å‰100åªè‚¡ç¥¨
    data = ak.stock_zh_a_hist(symbol=symbol, period="daily", start_date="20230101", end_date="20241201")
    dm.save_stock_data(symbol, data)

print("æ•°æ®è·å–å®Œæˆï¼")
```

### 2. Javaæ•°æ®è¯»å–

```java
// Javaç«¯è¯»å–Pythonç”Ÿæˆçš„æ•°æ®
@Service
public class DataService {
    
    @Autowired
    private DataHandler dataHandler;
    
    public List<Bar> getHistoricalData(String symbol, LocalDate startDate, LocalDate endDate) {
        // ä»Parquetæ–‡ä»¶è¯»å–æ•°æ®
        return dataHandler.readParquetData(symbol, startDate, endDate);
    }
    
    public void subscribeRealtimeData(String symbol) {
        // è®¢é˜…å®æ—¶æ•°æ®ï¼ˆä»DuckDBè¯»å–ï¼‰
        dataHandler.subscribeMarketData(symbol);
    }
}
```

## ğŸ§  ç­–ç•¥å¼€å‘

### 1. Pythonç­–ç•¥åŸå‹

```python
from quantcapital.strategy.base_strategy import BaseStrategy

class MACrossStrategy(BaseStrategy):
    """ç§»åŠ¨å¹³å‡çº¿äº¤å‰ç­–ç•¥"""
    
    def __init__(self, short_window=10, long_window=30):
        super().__init__()
        self.short_window = short_window
        self.long_window = long_window
    
    def on_bar(self, bar):
        # è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
        short_ma = self.get_indicator('ma', self.short_window)
        long_ma = self.get_indicator('ma', self.long_window)
        
        # ç”Ÿæˆäº¤æ˜“ä¿¡å·
        if short_ma > long_ma and self.position == 0:
            self.buy(bar.symbol, 1000)  # ä¹°å…¥1000è‚¡
        elif short_ma < long_ma and self.position > 0:
            self.sell(bar.symbol, self.position)  # å…¨éƒ¨å–å‡º
```

### 2. Javaç­–ç•¥å®ç°

```java
@Component
public class MACrossStrategy extends BaseStrategy {
    
    private final int shortWindow = 10;
    private final int longWindow = 30;
    
    @Override
    public void onBar(Bar bar) {
        // è·å–æŠ€æœ¯æŒ‡æ ‡æ•°æ®
        double shortMa = indicatorService.getMA(bar.getSymbol(), shortWindow);
        double longMa = indicatorService.getMA(bar.getSymbol(), longWindow);
        
        Position position = portfolioManager.getPosition(bar.getSymbol());
        
        // äº¤æ˜“é€»è¾‘
        if (shortMa > longMa && position.getQuantity() == 0) {
            // å‘é€ä¹°å…¥ä¿¡å·
            SignalEvent signal = SignalEvent.builder()
                .symbol(bar.getSymbol())
                .signalType(SignalType.LONG)
                .strength(1.0)
                .build();
            eventEngine.publish(signal);
        } else if (shortMa < longMa && position.getQuantity() > 0) {
            // å‘é€å–å‡ºä¿¡å·
            SignalEvent signal = SignalEvent.builder()
                .symbol(bar.getSymbol())
                .signalType(SignalType.SHORT)
                .strength(1.0)
                .build();
            eventEngine.publish(signal);
        }
    }
}
```

## ğŸ“ˆ å›æµ‹æµç¨‹

### 1. é…ç½®å›æµ‹å‚æ•°

```yaml
quantcapital:
  backtest:
    start-date: "2023-01-01"
    end-date: "2024-01-01"
    initial-capital: 1000000.0
    benchmark: "000300.SH"
    universe: ["000001.SZ", "000002.SZ", "600000.SH"]  # è‚¡ç¥¨æ± 
```

### 2. å¯åŠ¨å›æµ‹

```bash
# å¯åŠ¨å›æµ‹æ¨¡å¼
mvn spring-boot:run -Dspring.profiles.active=backtest -Dstrategy.class=MACrossStrategy

# æŸ¥çœ‹å›æµ‹ç»“æœ
tail -f logs/backtest.log
```

### 3. å›æµ‹ç»“æœåˆ†æ

```bash
# å›æµ‹å®Œæˆåï¼ŒæŸ¥çœ‹æ€§èƒ½æŠ¥å‘Š
cat results/backtest_report.json

# æŸ¥çœ‹äº¤æ˜“æ˜ç»†
cat results/trades.csv

# æŸ¥çœ‹æŒä»“å˜åŒ–
cat results/positions.csv
```

## ğŸ›¡ï¸ é£é™©ç®¡ç†

### 1. ä»“ä½æ§åˆ¶

```java
@Component
public class RiskManager {
    
    @Value("${quantcapital.risk.max-position-pct:0.05}")
    private double maxPositionPct;
    
    public boolean checkPositionRisk(String symbol, double orderValue) {
        double currentPortfolioValue = portfolioManager.getTotalValue();
        double maxAllowedValue = currentPortfolioValue * maxPositionPct;
        
        Position position = portfolioManager.getPosition(symbol);
        double newPositionValue = position.getMarketValue() + orderValue;
        
        return newPositionValue <= maxAllowedValue;
    }
}
```

### 2. æ­¢æŸè®¾ç½®

```java
@Component
public class StopLossStrategy extends BaseStrategy {
    
    @Value("${quantcapital.risk.stop-loss-pct:0.1}")
    private double stopLossPct;
    
    @Override
    public void onBar(Bar bar) {
        Position position = portfolioManager.getPosition(bar.getSymbol());
        
        if (position.getQuantity() > 0) {
            double currentPrice = bar.getClose();
            double avgCost = position.getAvgCost();
            double lossRatio = (avgCost - currentPrice) / avgCost;
            
            if (lossRatio >= stopLossPct) {
                // è§¦å‘æ­¢æŸ
                SignalEvent stopLossSignal = SignalEvent.builder()
                    .symbol(bar.getSymbol())
                    .signalType(SignalType.STOP_LOSS)
                    .strength(1.0)
                    .reason("æ­¢æŸè§¦å‘ï¼ŒäºæŸæ¯”ä¾‹ï¼š" + String.format("%.2f%%", lossRatio * 100))
                    .build();
                eventEngine.publish(stopLossSignal);
            }
        }
    }
}
```

## ğŸ“Š ç›‘æ§é¢æ¿

### 1. Webç›‘æ§ç•Œé¢

å¯åŠ¨ç³»ç»Ÿåï¼Œè®¿é—®ç›‘æ§é¢æ¿ï¼š

```
http://localhost:8080/actuator/health    # ç³»ç»Ÿå¥åº·çŠ¶æ€
http://localhost:8080/metrics            # æ€§èƒ½æŒ‡æ ‡
http://localhost:8080/portfolio          # ç»„åˆçŠ¶æ€
http://localhost:8080/orders             # è®¢å•çŠ¶æ€
```

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1ï¼šJavaå¯åŠ¨æŠ¥é”™"è™šæ‹Ÿçº¿ç¨‹ä¸æ”¯æŒ"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥Javaç‰ˆæœ¬
java -version

# ç¡®ä¿ä½¿ç”¨JDK 21+
export JAVA_HOME=/path/to/jdk21
```

### Q2ï¼šPythonæ•°æ®è·å–è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# å¢åŠ è¯·æ±‚å»¶è¿Ÿ
config['data_source']['request_delay'] = 1.0  # å¢åŠ åˆ°1ç§’

# ä½¿ç”¨ä»£ç†
import akshare as ak
ak.set_token("your_token_here")  # è®¾ç½®token
```

### Q3ï¼šå†…å­˜ä¸è¶³é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¢åŠ JVMå†…å­˜
export JAVA_OPTS="-Xmx8g -XX:+UseZGC"

# å¯åŠ¨æ—¶æŒ‡å®šå†…å­˜
mvn spring-boot:run -Dspring-boot.run.jvmArguments="-Xmx8g"
```

### Q4ï¼šæ•°æ®æ–‡ä»¶è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# ç¡®ä¿é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„æ­£ç¡®
quantcapital:
  data:
    root-path: "./python/data"  # ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **é¡¹ç›®æ–‡æ¡£**ï¼š`docs/å¼€å‘è€…æŒ‡å—.md`
- **ç¤ºä¾‹ä»£ç **ï¼š`examples/` ç›®å½•
- **å•å…ƒæµ‹è¯•**ï¼š`src/test/` ç›®å½•
- **é…ç½®æ¨¡æ¿**ï¼š`src/main/resources/` ç›®å½•

ç¥æ‚¨é‡åŒ–äº¤æ˜“é¡ºåˆ©ï¼ğŸš€