# QuantCapital é‡åŒ–äº¤æ˜“ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç†å¿µ

æœ¬é‡åŒ–äº¤æ˜“ç³»ç»Ÿé‡‡ç”¨Python+Javaæ··åˆæ¶æ„ï¼ŒåŸºäºä»¥ä¸‹æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š

1. **è¯­è¨€ç‰¹é•¿ä¼˜åŒ–**ï¼šå……åˆ†å‘æŒ¥Pythonæ•°æ®å¤„ç†ä¼˜åŠ¿å’ŒJavaé«˜æ€§èƒ½è®¡ç®—èƒ½åŠ›
2. **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šé€šè¿‡äº‹ä»¶è§£è€¦å„æ¨¡å—ï¼Œå®ç°é«˜å¹¶å‘å¼‚æ­¥å¤„ç†
3. **å›æµ‹å®ç›˜ä¸€è‡´æ€§**ï¼šç­–ç•¥ä»£ç æ— éœ€åŒºåˆ†è¿è¡Œç¯å¢ƒï¼Œç¡®ä¿é€»è¾‘ä¸€è‡´æ€§
4. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œæ”¯æŒç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
5. **æ€§èƒ½ä¸æ˜“ç”¨å¹³è¡¡**ï¼šåœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹ï¼Œç»´æŒå¼€å‘çš„ä¾¿åˆ©æ€§

### æ¶æ„é€‰å‹ç†ç”±

#### Python+Javaæ··åˆæ¶æ„çš„ä¼˜åŠ¿

**PythonèŒè´£**ï¼ˆæ•°æ®å¤„ç†å±‚ï¼‰

- æ•°æ®è·å–ï¼šAKShareç­‰ç¬¬ä¸‰æ–¹æ•°æ®æºç”Ÿæ€ä¸°å¯Œ
- æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ï¼šTA-Libç­‰æˆç†Ÿåº“æ”¯æŒ
- æ•°æ®æ¸…æ´—ï¼šPandaså¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›
- æŠ¥å‘Šç”Ÿæˆï¼šmatplotlibã€plotlyç­‰å¯è§†åŒ–ç”Ÿæ€

**JavaèŒè´£**ï¼ˆæ ¸å¿ƒäº¤æ˜“å¼•æ“ï¼‰

- äº‹ä»¶å¤„ç†ï¼šé«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„äº‹ä»¶åˆ†å‘
- ç­–ç•¥æ‰§è¡Œï¼šç±»å‹å®‰å…¨ã€å†…å­˜å¯æ§çš„ç­–ç•¥è¿è¡Œ
- é£æ§ç®¡ç†ï¼šå®æ—¶é£é™©è®¡ç®—å’Œæ§åˆ¶
- è®¢å•æ‰§è¡Œï¼šç¨³å®šå¯é çš„äº¤æ˜“æ‰§è¡Œ

#### æ··åˆæ¶æ„å¸¦æ¥çš„æ€§èƒ½æå‡

```mermaid
graph LR
    subgraph "æ€§èƒ½å¯¹æ¯”"
        A[Pythonå•ä½“] --> B[5-10å€å»¶è¿Ÿæå‡]
        C[Javaå¼•æ“] --> D[1000+ç­–ç•¥å¹¶å‘]
        E[æ··åˆæ¶æ„] --> F[å†…å­˜ä½¿ç”¨ä¼˜åŒ–50%]
    end
    
    subgraph "å¼€å‘æ•ˆç‡"
        G[Pythonæ•°æ®å¤„ç†] --> H[å¼€å‘å‘¨æœŸçŸ­]
        I[Javaç±»å‹å®‰å…¨] --> J[è¿è¡Œæ—¶é”™è¯¯å°‘]
        K[æ¨¡å—åŒ–è®¾è®¡] --> L[å¹¶è¡Œå¼€å‘]
    end
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„åŸåˆ™

1. **è¿›ç¨‹åˆ†ç¦»åŸåˆ™**ï¼šæ•°æ®è·å–è¿›ç¨‹ä¸äº¤æ˜“å¼•æ“è¿›ç¨‹ç‹¬ç«‹è¿è¡Œï¼Œé¿å…ç›¸äº’å½±å“
2. **äº‹ä»¶é©±åŠ¨åŸåˆ™**ï¼šæ‰€æœ‰æ¨¡å—é—´é€šä¿¡é€šè¿‡äº‹ä»¶å®Œæˆï¼Œå®ç°æ¾è€¦åˆ
3. **æ•°æ®ä¸€è‡´æ€§åŸåˆ™**ï¼šç»Ÿä¸€çš„æ•°æ®æ ¼å¼å’Œè®¿é—®æ¥å£ï¼Œç¡®ä¿æ•°æ®è´¨é‡
4. **æ•…éšœéš”ç¦»åŸåˆ™**ï¼šå•ä¸ªæ¨¡å—æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿè¿è¡Œ
5. **å¯æ‰©å±•æ€§åŸåˆ™**ï¼šæ”¯æŒæ–°ç­–ç•¥ã€æ–°æ•°æ®æºã€æ–°æ‰§è¡Œå™¨çš„æ’ä»¶åŒ–æ‰©å±•

### ç³»ç»Ÿå±‚æ¬¡æ¶æ„

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        A1[ç­–ç•¥æ¨¡å—] --> A2[ç»„åˆé£æ§]
        A2 --> A3[æ‰§è¡Œå¼•æ“]
    end
    
    subgraph "æœåŠ¡å±‚"
        B1[äº‹ä»¶é©±åŠ¨å¼•æ“] --> B2[æ•°æ®è®¿é—®å±‚]
        B2 --> B3[é…ç½®ç®¡ç†]
    end
    
    subgraph "æ•°æ®å±‚"
        C1[Pythonæ•°æ®æœåŠ¡] --> C2[Parquetå­˜å‚¨]
        C2 --> C3[DuckDBæŸ¥è¯¢]
        C3 --> C4[SQLiteä¸šåŠ¡åº“]
    end
    
    A1 -.-> B1
    A2 -.-> B1
    A3 -.-> B1
    B2 -.-> C1
```

### æ ¸å¿ƒè®¾è®¡æ¨¡å¼

#### 1. äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼ˆEvent-Drivenï¼‰

**è®¾è®¡åŠ¨æœº**ï¼š

- è§£å†³æ¨¡å—é—´å¼ºè€¦åˆé—®é¢˜
- æ”¯æŒå¼‚æ­¥å¤„ç†ï¼Œæé«˜ç³»ç»Ÿååé‡
- ä¾¿äºç³»ç»Ÿç›‘æ§å’Œè°ƒè¯•

**å®ç°æ¶æ„**ï¼š

```java
// äº‹ä»¶å¼•æ“æ ¸å¿ƒè®¾è®¡
public class EventEngine {
    // è™šæ‹Ÿçº¿ç¨‹æ± 
    private final ExecutorService virtualThreadPool;
    
    // äº‹ä»¶åˆ†å‘é˜Ÿåˆ—
    private final BlockingQueue<Event> eventQueue;
    
    // è®¢é˜…è€…ç®¡ç†
    private final Map<String, List<EventHandler>> handlers;
}
```

#### 2. ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰

**è®¾è®¡åŠ¨æœº**ï¼š

- æ”¯æŒå¤šç§ç­–ç•¥ç®—æ³•çš„åŠ¨æ€åˆ‡æ¢
- ç­–ç•¥é€»è¾‘ä¸æ‰§è¡Œæ¡†æ¶è§£è€¦
- ä¾¿äºç­–ç•¥çš„æµ‹è¯•å’ŒéªŒè¯

**åˆ†ç±»è®¾è®¡**ï¼š

```java
public enum StrategyType {
    ENTRY,           // å¼€å•ç­–ç•¥ï¼šå¯»æ‰¾æ–°æœºä¼š
    EXIT,            // å¹³ä»“ç­–ç•¥ï¼šç®¡ç†å·²æœ‰æŒä»“
    UNIVERSAL_STOP   // é€šç”¨æ­¢æŸï¼šå…œåº•é£æ§
}
```

#### 3. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰

**è®¾è®¡åŠ¨æœº**ï¼š

- ç»Ÿä¸€ç­–ç•¥æ‰§è¡Œæµç¨‹
- å…è®¸å­ç±»è‡ªå®šä¹‰ç‰¹å®šæ­¥éª¤
- ç¡®ä¿å…³é”®æµç¨‹ä¸è¢«ç ´å

```java
public abstract class BaseStrategy {
    // æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰å›ºå®šæµç¨‹
    public final void processMarketEvent(MarketEvent event) {
        if (!shouldProcess(event)) return;
        
        List<Signal> signals = generateSignals(event);
        for (Signal signal : signals) {
            validateAndSendSignal(signal);
        }
    }
    
    // æŠ½è±¡æ–¹æ³•ï¼šå­ç±»å®ç°
    protected abstract List<Signal> generateSignals(MarketEvent event);
}
```

## ğŸ”„ Javaé‡åŒ–äº¤æ˜“æ¡†æ¶äº‹ä»¶æµæ¶æ„

### äº‹ä»¶ç±»å‹è®¾è®¡

#### æ ¸å¿ƒäº‹ä»¶å®šä¹‰

**1. MarketEventï¼ˆå¸‚åœºæ•°æ®äº‹ä»¶ï¼‰**

```java
public class MarketEvent extends Event {
    private final String symbol;        // æ ‡çš„ä»£ç 
    private final Bar latestBar;        // æœ€æ–°Kçº¿æ•°æ®
    private final Frequency frequency;  // æ•°æ®é¢‘ç‡
    private final LocalDateTime timestamp;
}
```

- **è®¾è®¡ç†ç”±**ï¼šå°†å¸‚åœºæ•°æ®æ›´æ–°æŠ½è±¡ä¸ºäº‹ä»¶ï¼Œæ”¯æŒå¤šé¢‘ç‡æ•°æ®æ¨é€
- **è§¦å‘æ—¶æœº**ï¼šæ•°æ®æ›´æ–°è¿›ç¨‹è·å–åˆ°æ–°çš„Kçº¿æ•°æ®æ—¶
- **è®¢é˜…è€…**ï¼šç­–ç•¥æ¨¡å—ã€æŒ‡æ ‡è®¡ç®—æ¨¡å—

**2. SignalEventï¼ˆäº¤æ˜“ä¿¡å·äº‹ä»¶ï¼‰**

```java
public class SignalEvent extends Event {
    private final String strategyId;            // ç­–ç•¥æ ‡è¯†
    private final String symbol;                // æ ‡çš„ä»£ç 
    private final SignalDirection direction;    // ä¿¡å·æ–¹å‘
    private final SignalStrengthLevel strength; // ä¿¡å·å¼ºåº¦
    private final BigDecimal referencePrice;    // å‚è€ƒä»·æ ¼
    private final String reason;                // ä¿¡å·åŸå› 
}
```

- **è®¾è®¡ç†ç”±**ï¼šæ ‡å‡†åŒ–ç­–ç•¥è¾“å‡ºï¼Œä¾¿äºåç»­å¤„ç†å’Œå®¡è®¡
- **è§¦å‘æ—¶æœº**ï¼šç­–ç•¥è®¡ç®—å‡ºæœ‰æ•ˆäº¤æ˜“ä¿¡å·æ—¶
- **è®¢é˜…è€…**ï¼šç»„åˆé£æ§æ¨¡å—

**3. OrderEventï¼ˆè®¢å•äº‹ä»¶ï¼‰**

```java
public class OrderEvent extends Event {
    private final String orderId;      // è®¢å•ID
    private final String symbol;       // æ ‡çš„ä»£ç 
    private final OrderSide side;      // ä¹°å–æ–¹å‘
    private final OrderType type;      // è®¢å•ç±»å‹
    private final Integer quantity;    // è®¢å•æ•°é‡
    private final BigDecimal price;    // è®¢å•ä»·æ ¼
}
```

- **è®¾è®¡ç†ç”±**ï¼šå°†äº¤æ˜“å†³ç­–è½¬åŒ–ä¸ºå…·ä½“çš„è®¢å•æŒ‡ä»¤
- **è§¦å‘æ—¶æœº**ï¼šç»„åˆé£æ§æ¨¡å—é€šè¿‡é£é™©æ£€æŸ¥å
- **è®¢é˜…è€…**ï¼šæ‰§è¡Œæ¨¡å—

**4. FillEventï¼ˆæˆäº¤äº‹ä»¶ï¼‰**

```java
public class FillEvent extends Event {
    private final String fillId;       // æˆäº¤ID
    private final String orderId;      // å…³è”è®¢å•ID
    private final String symbol;       // æ ‡çš„ä»£ç 
    private final Integer quantity;    // æˆäº¤æ•°é‡
    private final BigDecimal price;    // æˆäº¤ä»·æ ¼
    private final BigDecimal commission; // æ‰‹ç»­è´¹
}
```

- **è®¾è®¡ç†ç”±**ï¼šè®°å½•å®é™…æˆäº¤ç»“æœï¼Œæ›´æ–°è´¦æˆ·çŠ¶æ€
- **è§¦å‘æ—¶æœº**ï¼šè®¢å•æ‰§è¡Œå®Œæˆæ—¶
- **è®¢é˜…è€…**ï¼šè´¦æˆ·æ¨¡å—ã€ç»„åˆé£æ§æ¨¡å—

### äº‹ä»¶æµè½¬è®¾è®¡

#### å®Œæ•´æµè½¬æµç¨‹

```mermaid
sequenceDiagram
    participant DataService as Pythonæ•°æ®æœåŠ¡
    participant EventEngine as äº‹ä»¶å¼•æ“
    participant Strategy as ç­–ç•¥æ¨¡å—
    participant Portfolio as ç»„åˆé£æ§
    participant Execution as æ‰§è¡Œæ¨¡å—
    participant Account as è´¦æˆ·æ¨¡å—

    DataService->>EventEngine: MarketEvent(æ–°Kçº¿æ•°æ®)
    EventEngine->>Strategy: åˆ†å‘åˆ°ç­–ç•¥å®ä¾‹
    
    Strategy->>Strategy: è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
    Strategy->>Strategy: æ‰§è¡Œç­–ç•¥é€»è¾‘
    Strategy->>EventEngine: SignalEvent(äº¤æ˜“ä¿¡å·)
    
    EventEngine->>Portfolio: åˆ†å‘åˆ°é£æ§æ¨¡å—
    Portfolio->>Portfolio: é£é™©æ£€æŸ¥
    Portfolio->>Portfolio: èµ„é‡‘åˆ†é…
    Portfolio->>EventEngine: OrderEvent(ä¸‹å•æŒ‡ä»¤)
    
    EventEngine->>Execution: åˆ†å‘åˆ°æ‰§è¡Œæ¨¡å—
    Execution->>Execution: è®¢å•æ‰§è¡Œ
    Execution->>EventEngine: FillEvent(æˆäº¤å›æŠ¥)
    
    EventEngine->>Account: æ›´æ–°è´¦æˆ·çŠ¶æ€
    EventEngine->>Portfolio: æ›´æ–°æŒä»“ä¿¡æ¯
```

#### äº‹ä»¶å¼•æ“é«˜æ€§èƒ½è®¾è®¡

**è™šæ‹Ÿçº¿ç¨‹æ¶æ„**

```java
public class EventEngine {
    // ä½¿ç”¨Java 24è™šæ‹Ÿçº¿ç¨‹
    private final ExecutorService virtualThreadPool = 
        Executors.newVirtualThreadPerTaskExecutor();
    
    // é«˜æ€§èƒ½äº‹ä»¶åˆ†å‘
    public void publishEvent(Event event) {
        // å¿«é€Ÿåˆ†å‘ï¼Œä¸ç­‰å¾…å¤„ç†
        List<EventHandler> eventHandlers = handlers.get(event.getType());
        for (EventHandler handler : eventHandlers) {
            virtualThreadPool.submit(() -> {
                try {
                    handler.handleEvent(event);
                } catch (Exception e) {
                    // æ•…éšœéš”ç¦»ï¼šå•ä¸ªå¤„ç†å™¨å¼‚å¸¸ä¸å½±å“å…¶ä»–
                    handleError(handler, event, e);
                }
            });
        }
    }
}
```

**èƒŒå‹å¤„ç†æœºåˆ¶**

- é˜Ÿåˆ—å®¹é‡é™åˆ¶ï¼šé˜²æ­¢å†…å­˜æº¢å‡º
- ä¼˜å…ˆçº§å¤„ç†ï¼šé«˜ä¼˜å…ˆçº§äº‹ä»¶ä¼˜å…ˆå¤„ç†
- ä¸¢å¼ƒç­–ç•¥ï¼šé˜Ÿåˆ—æ»¡æ—¶æ™ºèƒ½ä¸¢å¼ƒä½ä¼˜å…ˆçº§äº‹ä»¶

## ğŸ§© æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. ç­–ç•¥æ¨¡å—è®¾è®¡

#### ç­–ç•¥åˆ†ç±»ä¸èŒè´£åˆ’åˆ†

**è®¾è®¡ç†å¿µ**ï¼š

- å•ä¸€èŒè´£åŸåˆ™ï¼šæ¯ç§ç­–ç•¥ç±»å‹ä¸“æ³¨ç‰¹å®šåŠŸèƒ½
- é¿å…èŒè´£é‡å ï¼šå¼€å•ç­–ç•¥ä¸å¤„ç†å¹³ä»“é€»è¾‘
- ååŒå·¥ä½œï¼šå¤šç§ç­–ç•¥ç±»å‹é…åˆå½¢æˆå®Œæ•´äº¤æ˜“ç³»ç»Ÿ

**ç­–ç•¥ç±»å‹å®šä¹‰**ï¼š

```java
public enum StrategyType {
    ENTRY("entry", "å¼€å•ç­–ç•¥"),
    EXIT("exit", "å¹³ä»“ç­–ç•¥"),
    UNIVERSAL_STOP("universal_stop", "é€šç”¨æ­¢æŸç­–ç•¥");
}
```

**èŒè´£è¾¹ç•Œ**ï¼š

| ç­–ç•¥ç±»å‹ | å…³æ³¨æ ‡çš„ | æ ¸å¿ƒèŒè´£ | è®¾è®¡è€ƒè™‘ |
|---------|---------|---------|---------|
| å¼€å•ç­–ç•¥ | å…¨å¸‚åœº - å·²æŒæœ‰ | å‘ç°æ–°æœºä¼š | é¿å…é‡å¤å¼€å• |
| å¹³ä»“ç­–ç•¥ | æœ¬ç­–ç•¥æŒä»“ | æ­¢ç›ˆæ­¢æŸç®¡ç† | ä¸å¼€å•ç­–ç•¥é…å¯¹ |
| é€šç”¨æ­¢æŸ | æ‰€æœ‰æŒä»“ | å…œåº•é£æ§ | é˜²èŒƒæç«¯é£é™© |

#### ç­–ç•¥åè°ƒæœºåˆ¶è®¾è®¡

**åŠ¨æ€æ ‡çš„èŒƒå›´æ›´æ–°**ï¼š

```java
public abstract class BaseStrategy implements EventHandler {
    protected Set<String> getWatchSymbols() {
        switch (this.strategyType) {
            case ENTRY:
                return getAllSymbols().stream()
                    .filter(symbol -> !hasPosition(symbol))
                    .collect(Collectors.toSet());
            case EXIT:
                return getPositions().stream()
                    .filter(pos -> pos.getStrategyId().equals(this.strategyId))
                    .map(Position::getSymbol)
                    .collect(Collectors.toSet());
            case UNIVERSAL_STOP:
                return getPositions().stream()
                    .map(Position::getSymbol)
                    .collect(Collectors.toSet());
        }
    }
}
```

**ä»“ä½æ ‡è®°ç³»ç»Ÿ**ï¼š

```java
public class Position {
    private String symbol;              // æ ‡çš„ä»£ç 
    private String entryStrategyId;     // å¼€ä»“ç­–ç•¥ID
    private String exitStrategyId;      // å¹³ä»“ç­–ç•¥IDï¼ˆå¯é€‰ï¼‰
    private Integer quantity;           // æŒä»“æ•°é‡
    private BigDecimal avgPrice;        // å¹³å‡æˆæœ¬
}
```

### 2. ç»„åˆé£æ§æ¨¡å—è®¾è®¡

#### è®¾è®¡èŒè´£

**ä¿¡å·å¤„ç†ä¸å†³ç­–**ï¼š

```java
public class PortfolioManager implements EventHandler {
    
    @Override
    public void handleEvent(Event event) {
        if (event instanceof SignalEvent) {
            processSignal((SignalEvent) event);
        } else if (event instanceof FillEvent) {
            updatePosition((FillEvent) event);
        }
    }
    
    private void processSignal(SignalEvent signal) {
        // 1. ä¿¡å·æœ‰æ•ˆæ€§æ£€æŸ¥
        if (!isValidSignal(signal)) return;
        
        // 2. é£é™©æ§åˆ¶æ£€æŸ¥
        if (!passRiskCheck(signal)) return;
        
        // 3. èµ„é‡‘åˆ†é…
        BigDecimal orderSize = calculateOrderSize(signal);
        
        // 4. ç”Ÿæˆè®¢å•
        OrderEvent order = createOrder(signal, orderSize);
        eventEngine.publishEvent(order);
    }
}
```

#### é£æ§è§„åˆ™è®¾è®¡

**å¤šå±‚é£æ§æ¶æ„**ï¼š

```java
public class RiskManager {
    
    // ç¬¬ä¸€å±‚ï¼šå•æ ‡çš„é£æ§
    public boolean checkSingleStockRisk(String symbol, BigDecimal orderValue) {
        BigDecimal currentValue = getCurrentPosition(symbol);
        BigDecimal totalValue = account.getTotalValue();
        
        return (currentValue.add(orderValue)).divide(totalValue)
            .compareTo(config.getSingleStockLimit()) <= 0;
    }
    
    // ç¬¬äºŒå±‚ï¼šç­–ç•¥ç»„é£æ§
    public boolean checkStrategyGroupRisk(String strategyId, BigDecimal orderValue) {
        BigDecimal strategyValue = getStrategyTotalValue(strategyId);
        BigDecimal totalValue = account.getTotalValue();
        
        return (strategyValue.add(orderValue)).divide(totalValue)
            .compareTo(config.getStrategyGroupLimit()) <= 0;
    }
    
    // ç¬¬ä¸‰å±‚ï¼šæ•´ä½“ä»“ä½é£æ§
    public boolean checkTotalPositionRisk() {
        BigDecimal positionValue = account.getTotalPositionValue();
        BigDecimal totalValue = account.getTotalValue();
        
        return positionValue.divide(totalValue)
            .compareTo(config.getTotalPositionLimit()) <= 0;
    }
}
```

### 3. æ‰§è¡Œæ¨¡å—è®¾è®¡

#### æ‰§è¡Œå™¨æŠ½è±¡è®¾è®¡

```java
public abstract class ExecutionHandler implements EventHandler {
    
    @Override
    public void handleEvent(Event event) {
        if (event instanceof OrderEvent) {
            executeOrder((OrderEvent) event);
        }
    }
    
    protected abstract void executeOrder(OrderEvent orderEvent);
    
    protected void sendFillEvent(Fill fill) {
        FillEvent fillEvent = new FillEvent(fill);
        eventEngine.publishEvent(fillEvent);
    }
}
```

#### å›æµ‹æ‰§è¡Œå™¨è®¾è®¡

**å¸‚åœºç‰¹æ€§æ¨¡æ‹Ÿ**ï¼š

```java
public class SimulatedExecutionHandler extends ExecutionHandler {
    
    @Override
    protected void executeOrder(OrderEvent orderEvent) {
        // 1. å»¶è¿Ÿæ¨¡æ‹Ÿ
        simulateLatency();
        
        // 2. æ»‘ç‚¹è®¡ç®—
        BigDecimal executionPrice = calculateSlippage(orderEvent);
        
        // 3. éƒ¨åˆ†æˆäº¤æ¨¡æ‹Ÿ
        Integer filledQuantity = simulatePartialFill(orderEvent);
        
        // 4. æ‰‹ç»­è´¹è®¡ç®—
        BigDecimal commission = calculateCommission(orderEvent, filledQuantity);
        
        // 5. ç”Ÿæˆæˆäº¤
        Fill fill = createFill(orderEvent, executionPrice, filledQuantity, commission);
        sendFillEvent(fill);
    }
    
    private BigDecimal calculateSlippage(OrderEvent order) {
        BigDecimal basePrice = order.getPrice();
        BigDecimal slippageRate = config.getSlippageRate();
        
        if (order.getSide() == OrderSide.BUY) {
            return basePrice.multiply(BigDecimal.ONE.add(slippageRate));
        } else {
            return basePrice.multiply(BigDecimal.ONE.subtract(slippageRate));
        }
    }
}
```

### 4. æ•°æ®æ¶æ„è®¾è®¡

#### åˆ†å±‚å­˜å‚¨è®¾è®¡ç†å¿µ

**å­˜å‚¨åˆ†å±‚çš„è®¾è®¡åŠ¨æœº**ï¼š

- **æ€§èƒ½åˆ†å±‚**ï¼šçƒ­æ•°æ®å†…å­˜è®¿é—®ï¼Œå†·æ•°æ®ç£ç›˜å­˜å‚¨
- **æŸ¥è¯¢åˆ†å±‚**ï¼šOLAPæŸ¥è¯¢ç”¨åˆ—å­˜ï¼ŒOLTPæ“ä½œç”¨è¡Œå­˜
- **æˆæœ¬åˆ†å±‚**ï¼šå¸¸ç”¨æ•°æ®å¿«é€Ÿè®¿é—®ï¼Œå†å²æ•°æ®å‹ç¼©å­˜å‚¨

#### æ•°æ®æµæ¶æ„

```mermaid
graph TB
    subgraph "æ•°æ®è·å–å±‚"
        A1[AKShareæ•°æ®æº] --> A2[æ•°æ®æ¸…æ´—æ¨¡å—]
        A2 --> A3[æŠ€æœ¯æŒ‡æ ‡è®¡ç®—]
    end
    
    subgraph "å­˜å‚¨å±‚"
        B1[Parqueté•¿æœŸå­˜æ¡£] 
        B2[DuckDBå†…å­˜æŸ¥è¯¢]
        B3[SQLiteä¸šåŠ¡æ•°æ®åº“]
    end
    
    subgraph "è®¿é—®å±‚"
        C1[DataHandleræ¥å£]
        C2[BacktestDataHandler]
        C3[LiveDataHandler]
    end
    
    A3 --> B1
    A3 --> B3
    B1 --> B2
    B2 --> C1
    B3 --> C1
    C1 --> C2
    C1 --> C3
```

#### æ•°æ®è®¿é—®æ¥å£è®¾è®¡

**ç»Ÿä¸€æ¥å£åŸåˆ™**ï¼š

```java
public interface DataHandler {
    
    // é¿å…æœªæ¥å‡½æ•°ï¼šåªèƒ½è·å–å½“å‰æ—¶é—´ä¹‹å‰çš„æ•°æ®
    List<Bar> getBars(String symbol, LocalDateTime start, LocalDateTime end, Frequency frequency);
    
    // æœ€æ–°æ•°æ®è·å–ï¼šå›æµ‹è¿”å›æ¨¡æ‹Ÿæ—¶é—´çš„æ•°æ®ï¼Œå®ç›˜è¿”å›çœŸå®æœ€æ–°æ•°æ®
    Optional<Bar> getLatestBar(String symbol, Frequency frequency);
    
    // æ‰¹é‡æ•°æ®è·å–ï¼šæ€§èƒ½ä¼˜åŒ–
    Map<String, List<Bar>> getLatestBars(Set<String> symbols, Frequency frequency, int count);
}
```

**å›æµ‹ä¸å®ç›˜å®ç°å·®å¼‚**ï¼š

```java
// å›æµ‹å®ç°ï¼šåŸºäºå†å²æ•°æ®çš„æ—¶é—´æ¨¡æ‹Ÿ
public class BacktestDataHandler implements DataHandler {
    private LocalDateTime currentTime; // æ¨¡æ‹Ÿå½“å‰æ—¶é—´
    
    @Override
    public Optional<Bar> getLatestBar(String symbol, Frequency frequency) {
        return dataStore.getBars(symbol, frequency)
            .stream()
            .filter(bar -> !bar.getTimestamp().isAfter(currentTime))
            .max(Comparator.comparing(Bar::getTimestamp));
    }
}

// å®ç›˜å®ç°ï¼šåŸºäºå®æ—¶æ•°æ®
public class LiveDataHandler implements DataHandler {
    @Override
    public Optional<Bar> getLatestBar(String symbol, Frequency frequency) {
        return realTimeDataProvider.getCurrentBar(symbol, frequency);
    }
}
```

## ğŸš€ æŠ€æœ¯é€‰å‹ä¸å®ç°

### JavaæŠ€æœ¯æ ˆé€‰æ‹©

#### JDK 24 + ZGCçš„é€‰æ‹©ç†ç”±

**JDK 24å…³é”®ç‰¹æ€§**ï¼š

- **è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰**ï¼šæ”¯æŒç™¾ä¸‡çº§çº¿ç¨‹å¹¶å‘ï¼Œéå¸¸é€‚åˆäº‹ä»¶é©±åŠ¨æ¶æ„
- **æ¨¡å¼åŒ¹é…å¢å¼º**ï¼šç®€åŒ–äº‹ä»¶ç±»å‹åˆ¤æ–­å’Œå¤„ç†é€»è¾‘
- **è®°å½•ç±»ï¼ˆRecordï¼‰**ï¼šç®€åŒ–å®ä½“ç±»å®šä¹‰ï¼Œå‡å°‘æ ·æ¿ä»£ç 

**ZGCåƒåœ¾å›æ”¶å™¨**ï¼š

- **ä½å»¶è¿Ÿ**ï¼šGCåœé¡¿æ—¶é—´ < 10msï¼Œæ»¡è¶³é«˜é¢‘äº¤æ˜“éœ€æ±‚
- **å†…å­˜æ•ˆç‡**ï¼šæ”¯æŒTBçº§å†…å­˜ï¼Œé€‚åˆå¤§é‡å†å²æ•°æ®å¤„ç†
- **å¹¶å‘å›æ”¶**ï¼šGCä¸åº”ç”¨çº¿ç¨‹å¹¶å‘è¿è¡Œï¼Œå‡å°‘æ€§èƒ½å½±å“

#### Spring Boot 3çš„é›†æˆè€ƒè™‘

**é€‰æ‹©ç†ç”±**ï¼š

- **é…ç½®ç®¡ç†**ï¼šå¼ºå¤§çš„é…ç½®ç»‘å®šå’ŒéªŒè¯æœºåˆ¶
- **ä¾èµ–æ³¨å…¥**ï¼šç®€åŒ–æ¨¡å—é—´ä¾èµ–ç®¡ç†
- **ç›‘æ§é›†æˆ**ï¼šå†…ç½®ç›‘æ§æŒ‡æ ‡å’Œå¥åº·æ£€æŸ¥
- **ç”Ÿäº§å°±ç»ª**ï¼šå®Œå–„çš„ç”Ÿäº§ç¯å¢ƒæ”¯æŒ

**æ ¸å¿ƒé…ç½®è®¾è®¡**ï¼š

```yaml
quantcapital:
  data:
    root-path: /data/quantcapital
    cache-size: 1000
  
  execution:
    slippage-rate: 0.001
    commission-rate: 0.0003
    
  risk:
    single-stock-limit: 0.05
    strategy-group-limit: 0.20
    total-position-limit: 0.95
```

### PythonæŠ€æœ¯æ ˆé€‰æ‹©

#### æ•°æ®å¤„ç†åº“é€‰æ‹©

**Pandas vs Polarsæƒè¡¡**ï¼š

- **Pandas**ï¼šç”Ÿæ€æˆç†Ÿï¼ŒAKShareç­‰åº“æ”¯æŒå¥½
- **Polars**ï¼šæ€§èƒ½æ›´ä¼˜ï¼Œä½†ç”Ÿæ€ç›¸å¯¹è¾ƒæ–°
- **é€‰æ‹©ç­–ç•¥**ï¼šä¸»è¦ä½¿ç”¨Pandasï¼Œæ€§èƒ½ç“¶é¢ˆå¤„å¼•å…¥Polars

**å­˜å‚¨æŠ€æœ¯é€‰æ‹©**ï¼š

```python
# Parquetï¼šåˆ—å¼å­˜å‚¨ï¼Œå‹ç¼©æ¯”é«˜ï¼ŒæŸ¥è¯¢æ€§èƒ½å¥½
import pyarrow.parquet as pq

# DuckDBï¼šå†…å­˜åˆ†ææ•°æ®åº“ï¼ŒSQLå…¼å®¹æ€§å¥½
import duckdb

# SQLiteï¼šè½»é‡çº§äº‹åŠ¡æ•°æ®åº“ï¼Œéƒ¨ç½²ç®€å•
import sqlite3
```

### æ€§èƒ½ä¼˜åŒ–è®¾è®¡

#### Javaæ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**JVMå‚æ•°ä¼˜åŒ–**ï¼š

```bash
# ç”Ÿäº§ç¯å¢ƒJVMå‚æ•°
java -XX:+UseZGC \
     -XX:+UnlockExperimentalVMOptions \
     -Xmx8g \
     -XX:MaxDirectMemorySize=2g \
     -jar trading-engine.jar
```

**å†…å­˜ç®¡ç†ä¼˜åŒ–**ï¼š

```java
// å¯¹è±¡æ± å‡å°‘GCå‹åŠ›
public class EventPool {
    private final Queue<MarketEvent> marketEventPool = new ConcurrentLinkedQueue<>();
    
    public MarketEvent borrowMarketEvent() {
        MarketEvent event = marketEventPool.poll();
        return event != null ? event : new MarketEvent();
    }
    
    public void returnMarketEvent(MarketEvent event) {
        event.reset(); // é‡ç½®çŠ¶æ€
        marketEventPool.offer(event);
    }
}
```

#### æ•°æ®è®¿é—®ä¼˜åŒ–

**ç¼“å­˜ç­–ç•¥**ï¼š

```java
@Component
public class DataCache {
    // LRUç¼“å­˜æœ€è¿‘è®¿é—®çš„Kçº¿æ•°æ®
    private final Cache<String, List<Bar>> barCache = 
        Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterAccess(1, TimeUnit.HOURS)
            .build();
}
```

**æ‰¹é‡åŠ è½½**ï¼š

```java
// é¢„åŠ è½½ç­–ç•¥ï¼šå¯åŠ¨æ—¶åŠ è½½çƒ­é—¨è‚¡ç¥¨æ•°æ®
@PostConstruct
public void preloadData() {
    List<String> hotStocks = getHotStocks();
    
    hotStocks.parallelStream().forEach(symbol -> {
        List<Bar> bars = dataHandler.getBars(symbol, 
            LocalDateTime.now().minusMonths(6), 
            LocalDateTime.now(), 
            Frequency.DAILY);
        dataCache.put(symbol, bars);
    });
}
```

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶åŒ–æ¶æ„

#### ç­–ç•¥æ’ä»¶æœºåˆ¶

```java
// ç­–ç•¥å‘ç°æœºåˆ¶
@Component
public class StrategyRegistry {
    
    @EventListener
    public void onApplicationReady(ApplicationReadyEvent event) {
        // æ‰«æç­–ç•¥ç±»
        Set<Class<?>> strategyClasses = 
            reflections.getSubTypesOf(BaseStrategy.class);
        
        // æ³¨å†Œç­–ç•¥å®ä¾‹
        for (Class<?> clazz : strategyClasses) {
            if (clazz.isAnnotationPresent(Strategy.class)) {
                registerStrategy(clazz);
            }
        }
    }
}

// ç­–ç•¥æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Strategy {
    String value();                    // ç­–ç•¥åç§°
    StrategyType type();              // ç­–ç•¥ç±»å‹
    String[] dependencies() default {}; // ä¾èµ–ç­–ç•¥
}
```

#### æ•°æ®æºæ‰©å±•æœºåˆ¶

```java
// æ•°æ®æºæ¥å£
public interface DataSource {
    String getName();
    List<String> getSupportedSymbols();
    List<Bar> fetchBars(String symbol, LocalDateTime start, LocalDateTime end);
}

// æ•°æ®æºç®¡ç†å™¨
@Component
public class DataSourceManager {
    private final Map<String, DataSource> dataSources = new HashMap<>();
    
    @Autowired
    public DataSourceManager(List<DataSource> sources) {
        sources.forEach(source -> 
            dataSources.put(source.getName(), source));
    }
}
```

### é…ç½®é©±åŠ¨è®¾è®¡

#### å¤šç¯å¢ƒé…ç½®æ”¯æŒ

```yaml
# application-backtest.yml
quantcapital:
  mode: backtest
  data:
    handler: backtest
    start-date: 2020-01-01
    end-date: 2024-12-31
  
  execution:
    handler: simulated
    enable-slippage: true

---
# application-live.yml  
quantcapital:
  mode: live
  data:
    handler: live
    refresh-interval: 1s
  
  execution:
    handler: miniQMT
    enable-real-trading: true
```

#### åŠ¨æ€é…ç½®æ›´æ–°

```java
@Component
@ConfigurationProperties(prefix = "quantcapital")
public class QuantCapitalConfig {
    
    @EventListener
    public void onConfigChanged(ConfigChangedEvent event) {
        // é‡æ–°åŠ è½½é…ç½®
        refreshConfiguration();
        
        // é€šçŸ¥ç›¸å…³ç»„ä»¶
        applicationEventPublisher.publishEvent(
            new ConfigUpdatedEvent(this));
    }
}
```

## ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§

### ç›‘æ§æŒ‡æ ‡è®¾è®¡

#### ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

```java
@Component
public class TradingMetrics {
    
    private final MeterRegistry meterRegistry;
    
    // äº‹ä»¶å¤„ç†å»¶è¿Ÿç›‘æ§
    private final Timer eventProcessingTimer;
    
    // è®¢å•æ‰§è¡Œç»Ÿè®¡
    private final Counter orderExecutedCounter;
    
    // ç­–ç•¥ä¿¡å·ç»Ÿè®¡
    private final Gauge activeStrategiesGauge;
    
    public void recordEventProcessing(String eventType, Duration duration) {
        eventProcessingTimer.record(duration);
    }
}
```

#### ç³»ç»Ÿå¥åº·æ£€æŸ¥

```java
@Component
public class TradingHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        Health.Builder builder = new Health.Builder();
        
        // æ£€æŸ¥äº‹ä»¶å¼•æ“çŠ¶æ€
        if (eventEngine.isRunning()) {
            builder.up();
        } else {
            builder.down().withDetail("event-engine", "stopped");
        }
        
        // æ£€æŸ¥æ•°æ®è¿æ¥çŠ¶æ€  
        if (dataHandler.isConnected()) {
            builder.up();
        } else {
            builder.down().withDetail("data-connection", "disconnected");
        }
        
        return builder.build();
    }
}
```

### æ—¥å¿—è®¾è®¡

#### ç»“æ„åŒ–æ—¥å¿—

```java
// äº¤æ˜“æ—¥å¿—è®°å½•
@Slf4j
public class TradingLogger {
    
    public void logSignal(SignalEvent signal) {
        MDC.put("event_type", "SIGNAL");
        MDC.put("strategy_id", signal.getStrategyId());
        MDC.put("symbol", signal.getSymbol());
        
        log.info("Strategy signal generated: direction={}, strength={}, reason={}", 
            signal.getDirection(), 
            signal.getStrength(), 
            signal.getReason());
            
        MDC.clear();
    }
    
    public void logOrder(OrderEvent order) {
        MDC.put("event_type", "ORDER");
        MDC.put("order_id", order.getOrderId());
        
        log.info("Order placed: side={}, quantity={}, price={}", 
            order.getSide(), 
            order.getQuantity(), 
            order.getPrice());
            
        MDC.clear();
    }
}
```

## ğŸ¯ æœªæ¥æ‰©å±•è·¯çº¿

- MiniQMTå®ç›˜å¯¹æ¥
- å¯è§†åŒ–å¢å¼ºï¼šå®æ—¶ç›‘æ§ã€æŠ¥å‘Šå¯è§†åŒ–ã€å¤ç›˜å¯è§†åŒ–

---

æœ¬è®¾è®¡æ–‡æ¡£è¯¦ç»†é˜è¿°äº†QuantCapitalé‡åŒ–äº¤æ˜“ç³»ç»Ÿçš„æ¶æ„è®¾è®¡æ€è·¯ã€æŠ€æœ¯é€‰å‹å’Œå®ç°ç­–ç•¥ã€‚é€šè¿‡Python+Javaæ··åˆæ¶æ„ï¼Œç³»ç»Ÿå®ç°äº†é«˜æ€§èƒ½ä¸æ˜“ç”¨æ€§çš„å¹³è¡¡ï¼Œä¸ºé‡åŒ–äº¤æ˜“æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚
